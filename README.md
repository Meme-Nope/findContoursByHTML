# 🖼️ Flask Image Processor

画像前処理（ヒストグラム表示・輪郭抽出など）を行う Flask アプリケーションです。  
HTML UI 経由で画像をアップロードし、処理済み画像を確認できます。
次項のクイックスタートを完了させれば、直観的に画像処理を試すことが可能です。


## 🚀 クイックスタート（Docker使用）

### ✅ 前提条件

- Docker Desktop がインストールされていること
- Windowsであること(Macの場合、操作内容が少し変わる可能性がある)

### 1. Docker Desktopを起動する

左下に"Engine running"の表示があればOK

### 2. CodeをZIP形式でダウンロード

このGitHubページの「Code」ボタンをクリック  
「Download ZIP」を選択  
エクスプローラーからzipフォルダを右クリック→「すべて展開」

### 3. アプリ起動

解答したzipフォルダを右クリックして「ターミナルで開く(PowerShellで開く)」
開いたターミナル(Windows PowerShell)上で、次の一文を入力して、Enter

```bash
docker build -t flask-processor .
```
※最初だけ、起動に1分弱かかります。

起動が完了したら、更に次の一文を入力して、Enter

```bash
docker run --name contours-app -p 5000:5000 flask-processor
```

### 4. ブラウザでアクセス

http://localhost:5000 にアクセス

※アプリの性質上、ページをリフレッシュにより、エラーが起きることがあります。  
URLが「
http://localhost:5000/upload_single
」のようになっているので、
http://localhost:5000
に入力し直してください。

### 5. 画像とパラメータを入力

「ファイルの選択」から、処理したい画像を選ぶ  
※「ガウシアンぼかしサイズ」や「SIGMA_X」はまだ変える必要がない

「アップロード」をクリック

### 6. 彩度を確認

彩度をグラフ化したものが表示される

**基本的にはOTSU(大津の二値化)を推奨**

グラフの山が1つしかない場合、inRange(範囲指定)を推奨  
※このとき山の分布に合わせて、上限値と下限値を設定

最適な手法を選んで、「二値化して処理」

### 7. 結果の出力

処理済み画像が出力される

### 8. システムを止める

ターミナル(Windows PowerShell)上でctrl+Cを押すとシステムが止まる

### (9. もう一度使う)

ターミナル(Windows PowerShell)上で次の文を入力して、Enter
```bash
docker start contours-app
```
### (もしエラーが起きたら)

以下のエラーが発生することがある  
docker: Error response from daemon: Conflict. The container name "/contours-app" is already in use by container  

これは過去に作ったコンテナが邪魔をしている状態なので、  
ターミナル(Windows PowerShell)上で次の文を入力して、Enterを押すと直る
```bash
docker rm -f contours-app
```

## ハイパーパラメータの調整

画像処理が上手くいかないことも...  
その時は「ガウシアンぼかしサイズ」と「SIGMA_X」を調整してください 

余計なものが残っている→ガウシアンぼかしサイズを大きく  
必要なものも削られている→ガウシアンぼかしサイズを小さく  
境界がギザギザ→sigma_xを大きく  
境界がぼやけすぎ→sigma_xを小さく

※ガウシアンぼかしサイズを大きくしすぎると、処理が遅くなることがあります。

## 画像処理について
本システムの処理フローは、以下の研究を参考に構築しました。

中澤健介・山崎達也,
「洋ナシ果実を対象とした外観汚損検査サービスの開発」,
情報処理学会論文誌 コンシューマ・デバイス&システム, Vol.12, No.3, pp.1–9, 2022年9月.

処理手順（平滑化→二値化→輪郭抽出）は同論文の流れを踏襲しています。しかし、実装は独自に行っており、再現・商用利用を目的としたものではありません。  
また、一部の処理は参考文献と異なります。ご理解ください。

---

本アプリケーションに実装されている輪郭抽出処理は、もともと洋ナシ（ル レクチエ）の外観検査を目的とした処理フローに基づいて設計されています。  
具体的には、画像に対して平滑化・彩度成分の二値化・最大輪郭抽出を行うことにより、対象果実の輪郭を取得します。

この処理フローは以下のような条件下であれば、果実以外のオブジェクトにも適用可能であると考えています：

- 対象物が画像内に1つのみ写っていること
- 背景が単色または無地で、対象とのコントラストが明確であること
- 対象物の輪郭が比較的滑らかで閉じていること

これらの条件を満たす場合、工業製品の部品や文房具、食品などの静物画像に対しても、輪郭抽出処理を応用することが可能です。  
今後、応用対象の拡張や精度改善を通じて、より汎用的な画像前処理ツールとしての発展を目指しています。

## 📁 ディレクトリ構成
```
.
├── src/
│   ├── main.py         ← Flaskエントリーポイント
│   ├── processor.py    ← OpenCVによる画像処理
│   ├── templates/      ← index.htmlを保存
│   └── static/         ← 処理後画像やデザインを保存
├── requirements.txt    ← 必要なPythonライブラリ
├── Dockerfile          ← 実行環境定義
├── .gitignore          ← Gitレポジトリ除外設定
└── .dockerignore       ← ビルド除外設定

```